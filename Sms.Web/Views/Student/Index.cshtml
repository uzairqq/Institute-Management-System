@model IEnumerable<Sms.Domain.Dto.StudentDto>

@{
    Layout = "_Layout";
}

<br />
<div class="container-fluid">
    <ul class="list-inline">
        <li>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="clearTextBox();">Add New Employee</button><br /><br />
        </li>
    </ul>
</div>
<div class="container-fluid">

    <div class="form-group">
        <div class="table-responsive">
            <table id="studentTable" class="table table-hover table-bordered" style="width: 100%">
                <thead class="bg-primary">
                    <tr>
                        <td>Picture</td>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Gender</th>
                        <th>Address</th>
                        <th>Contact</th>
                        <td>Age</td>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Picture</td>
                            <td>@item.Name @item.Lastname</td>
                            <td>@item.Email</td>
                            <td>@item.Gender</td>
                            <td>@item.Address</td>
                            <td>@item.Contact</td>
                            <td>@item.Age</td>
                            <td>
                                <div class="float-left" style="margin-left: 7px;">
                                    <button type="button" class="btn btn-primary" id="btnUpdate" onclick="getbyID(@item.Id)">Update</button>
                                    @*<a asp-controller="Student" asp-action="Update"><i class="fa fa-user"></i></a>*@
                                </div>
                                <div class="float-left" style="margin-left: 7px;">
                                    <button type="button" class="btn btn-primary" onclick="Delete(@item.Id)">Delete</button>
                                    @*<span><a asp-controller="Student" asp-action="Delete"><i class="fa fa-remove"></i></a></span>*@
                                </div>
                                @*@Html.ActionLink("Update", "Update", "Student", new {id = item.Id, item.Name}, new {@class = "btn btn-primary"}) ||
                                    @Html.ActionLink("Delete", "Delete", "Student", new {id = item.Id}, new {@class = "btn btn-danger"})*@
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="abc" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Add Student</h4>

                @*<button type="button" class="close" data-dissmiss="modal"><span aria-hidden="true">×</span></button>*@
                <button type="button" class="close" data-dismiss="modal">x</button>
            </div>
            <div class="modal-body">
                <form>
                    @*<div class="form-group">*@
                            @*<label for="Id">ID</label>*@
                            <input type="hidden" class="form-control" id="Id" placeholder="Id" disabled="disabled"/>
                        @*</div>*@
                    <div class="form-group">
                        <label for="Name">Name</label>
                        <input type="text" name="Name" class="form-control" id="Name" placeholder="Name" />
                    </div>
                    <div class="form-group">
                        <label for="Age">Age</label>
                        <input type="text" name="Age" class="form-control" id="Age" placeholder="Age" />
                    </div>
                    <div class="form-group">
                        <label for="Contact">Contact</label>
                        <input type="text" name="Contact" class="form-control" id="Contact" placeholder="Contact" />
                    </div>
                    <div class="form-group">
                        <label for="Contact">Address</label>
                        <input type="text" name="Address" class="form-control" id="Address" placeholder="Address" />
                    </div>
                    <div class="form-group">
                        <label for="Email">Email</label>
                        <input type="text" name="Email" class="form-control" id="Email" placeholder="Email" />
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnAdd" onclick="return Add();">Add</button>
                <button type="button" class="btn btn-primary" id="btnUpdate" onclick="Update();">Save</button>
                <button type="button" class="btn btn-block" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script>
        $ = jQuery;
        $(document).ready(function() {
            $('#studentTable').DataTable({
            });
        });


        //Add Data Function
        function Add() {
            var res = validate();
            if (res == false) {
                return false;
            }
            var empObj = {
                id: $('#Id').val() || 0,
                name: $('#Name').val(),
                age: $('#Age').val(),
                contact: $('#Contact').val(),
                email: $('#Email').val(),
                address: $('#Address').val()
            };
            $.ajax({
                //url: "/Student/addNewStudent",
                url: "@Url.Action("Add", "Student")",
                data: JSON.stringify(empObj),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function(result) {
                    //loadData();
                    toastr.success(result.successMessage);
                    $('#myModal').modal('hide');

                },
                error: function (errormessage) {
                    toastr.error(errormessage.failureMessage);
                }
            });
        }


        function validate() {
            var isValid = true;
            if ($('#Name').val().trim() == "") {
                $('#Name').css('border-color', 'Red');
                isValid = false;
            } else {
                $('#Name').css('border-color', 'lightgrey');
            }
            if ($('#Age').val().trim() == "") {
                $('#Age').css('border-color', 'Red');
                isValid = false;
            } else {
                $('#Age').css('border-color', 'lightgrey');
            }
            if ($('#Contact').val().trim() == "") {
                $('#Contact').css('border-color', 'Red');
                isValid = false;
            } else {
                $('#Contact').css('border-color', 'lightgrey');
            }
            if ($('#Address').val().trim() == "") {
                $('#Address').css('border-color', 'Red');
                isValid = false;
            } else {
                $('#Address').css('border-color', 'lightgrey');
            }
            if ($('#Email').val().trim() == "") {
                $('#Email').css('border-color', 'Red');
                isValid = false;
            } else {
                $('#Email').css('border-color', 'lightgrey');
            }
            return isValid;
        }

        function getbyID(id) {
            $('#Name').css('border-color', 'green');
            $('#Age').css('border-color', 'lightgrey');
            $('#Contact').css('border-color', 'lightgrey');
            $('#Email').css('border-color', 'lightgrey');
            $.ajax({
                url: "/Student/GetById/" + id,
                type: "GET",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (result) {
                    console.log(result);
                    $('#Id').val(result.data.id);
                    $('#Name').val(result.data.name);
                    $('#Age').val(result.data.age);
                    $('#Contact').val(result.data.contact);
                    $('#Email').val(result.data.email);
                    $('#Address').val(result.data.address);
                    $('#myModal').modal('show');
                    $('#btnUpdate').show();
                    $('#btnAdd').hide();
                },
                error: function(errormessage) {
                    alert(errormessage.responseText);
                }
            });
            return false;
        }

        //Function for clearing the textboxes
        function clearTextBox() {
            $('#Id').val("");
            $('#Name').val("");
            $('#Age').val("");
            $('#Email').val("");
            $("#Address").val("");
            $('#Contact').val("");
            $('#btnUpdate').hide();
            $('#btnAdd').show();
            $('#Name').css('border-color', 'lightgrey');
            $('#Age').css('border-color', 'lightgrey');
            $('#Email').css('border-color', 'lightgrey');
            $('#Contact').css('border-color', 'lightgrey');
        }

        //function for updating employee's record
        function Update() {
            var res = validate();
            if (res == false) {
                return false;
            }
            var stuObj = {
                Id: $('#Id').val(),
                Name: $('#Name').val(),
                Age: $('#Age').val(),
                Contact: $('#Contact').val(),
                Email: $('#Email').val(),
                Address:$('#Address').val()
            };
            $.ajax({
                url: "/Student/Save",
                data: JSON.stringify(stuObj),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    toastr.success(result.successMessage);
                    //loadData();
                    $('#myModal').modal('hide');
                    $('#Id').val("");
                    $('#Name').val("");
                    $('#Age').val("");
                    $('#Address').val(""),
                    $('#Country').val("");
                    $('#Email').val("");
                },
                error: function (errormessage) {
                    toastr.error(errormessage.failureMessage);
                    alert(errormessage.responseText);
                }
            });
        }
        function Delete(Id) {

            var stuObj = {
                Id: Id
                //Name: $('#Name').val(),
                //Age: $('#Age').val(),
                //Contact: $('#Contact').val(),
                //Email: $('#Email').val(),
                //Address:$('#Address').val()
            };
            var ans = confirm("Are you sure you want to delete this Record?");
            if (ans) {
                $.ajax({
                    url: "/Student/Delete/",
                    type: "Delete",
                    data: JSON.stringify(stuObj),
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    success: function (result) {
                        //loadData();
                        toastr.success(result.successMessage);
                    },
                    error: function (errormessage) {
                        toastr.error(errormessage.failureMessage);
                        alert(errormessage.responseText);
                    }
                });
            }
        }
    </script>
}
@*<script>
        $(document).ready(function () {
            $('#studentTable').DataTable({
                ajax: "/Student/index/data",
                columns: [
                    {
                        data: "name"
                        //render: function(data,type,customer) {
                        //    return "<a href='/customers/edit/" + customer.id + "'>" + customer.name + "</a>";
                        //}
                    },
                    { data: "lastname", "autoWidth": true },
                    { data: "address", "autoWidth": true },
                    { data: "mobileNumber", "autoWidth": true },
                    { data: "homeNumber", "autoWidth": true },
                    { data: "email", "autoWidth": true },
                    {
                        "data": "Id",
                        "width": "50px",
                        render: function (data) {
                            return '<a class="btn btn-primary" href="/Student/PostData/' + data + '">Edit</a>';
                        }
                    }

                    //{
                    //    render: function (data, type, row) {
                    //        return '<a id="btnDelete' + row.companyId + '" class="delete-class btn btn-info btn-lg-block btn-md-block btn-sm-block btn-xs-block" href="#" data-toggle="modal">Delete</a>';
                    //    }
                    //}
                ]
            });
        });
        $('.tablecontainer').on('click',
            'a.popup',
            function(e) {
                e.preventDefault();
                OpenPopup($(this).attr('href'));
            });
    </script>*@







